(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function n(t,e,i){return(e=s(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(e){var i=function(e,i){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,i||"default");if("object"!==t(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"===t(i)?i:String(i)}var o=function(){function t(i){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"formNewOffer";e(this,t),n(this,"keywords",[]),n(this,"target",""),n(this,"baseForm",""),n(this,"input",[]),n(this,"listDiv",[]),n(this,"suggestions",[]),n(this,"count",0),n(this,"current",-1),n(this,"oldText",""),n(this,"hintText","кнопка &#8595; вставит догадку"),this.target=i,this.baseForm=s,this.input=$("#"+s+" #"+i),this.loadKeywords(i),this.listDiv=$("#"+s+" #suggestions-"+i),this.saveOldText()}var s,o,r;return s=t,(o=[{key:"loadKeywords",value:function(t){"title"==t?this.loadFromJson("models"):"descr"==t?this.loadFromJson("tasks"):console.error('Suggestions.load("'+t+'"): unknown target! ')}},{key:"loadFromJson",value:function(t){var e=this;$.getJSON("/ajax/"+t+".json").done((function(t){e.keywords=t}))}},{key:"suggest",value:function(t){if(t.length<2)return[];t=t.toLowerCase();var e=this.keywords.filter((function(e){return Object.values(e).some((function(e){return e.startsWith(t)}))})).slice(0,3);this.count=e.length,this.suggestions=e}},{key:"insertNextSuggestion",value:function(){this.count>0&&(this.current<this.count-1?this.current++:this.current=0,suggestion=this.suggestions[this.current].trg,this.insertSuggestion(suggestion))}},{key:"saveOldText",value:function(){this.oldText=$(this.input).val(),this.current=-1}},{key:"insertSuggestion",value:function(t){var e=(" "+this.oldText).replace(/(.*[\s,'"\.])([^\s,'"\.]+)$/,"$1"+t).substr(1);$(this.input).val(e)}},{key:"buildList",value:function(t){var e=this;if(this.clear(),this.suggest(t),this.count>0){for(var i in this.suggestions)this.listDiv.append('<div class="suggestion" data-realtarget="'+this.target+'">'+this.suggestions[i].trg+"</div>");this.listDiv.children().on("click",(function(t){e.insertSuggestion(t.target.innerText)})),this.listDiv.prepend('<div class="suggestions-hint w-100">'+this.hintText+"</div>")}}},{key:"buildListForLastWord",value:function(){var t=this.oldText.split(/[\s,'"\.]+/),e=t[t.length-1];this.buildList(e)}},{key:"clear",value:function(){this.count=0,this.current=-1,this.listDiv.empty()}}])&&i(s.prototype,o),r&&i(s,r),Object.defineProperty(s,"prototype",{writable:!1}),t}();jQuery((function(){$(".predictable").each((function(t,e){console.log(e),$(e).data("suggestions",new o(e.id))})),$(".predictable").on("keyup",(function(t){var e=$(this).data("suggestions");"ArrowDown"==t.key&&e.count>0?e.insertNextSuggestion():(e.saveOldText(),e.buildListForLastWord())})),$(".predictable").on("input",(function(t){$(this).data("suggestions").saveOldText()}))}))})();